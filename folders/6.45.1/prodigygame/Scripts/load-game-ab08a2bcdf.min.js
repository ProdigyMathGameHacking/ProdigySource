var SW=SW||{};SW.Load={};var prodigyWeb={};SW.Load.ERROR_TITLE_OLD_DEVICE="Warning!",SW.Load.ERROR_DESCRIPTION_OLD_DEVICE='You are using a device that does not have WebGL enabled.<br><br>You will need this to play Prodigy Math Game! <br><br>Please <a id="openfaq" href="#">read our FAQ</a> with a Parent or Guardian <br id="mobile-inline">for more information.',SW.Load.WEBGL_FAQ_URL="www.prodigygame.com/main-en/our-online-access-is-changing";var loadingText=["Feeding pets","Studying spells","Delivering mail","Counting coins","Rearranging furniture","Solving for x","Planting grass","Burying fossils","Darkening the tower","Stocking shops","Dirtying socks","Cutting pizza","Carving wands","Sewing outfits","Petting buddies","Gathering clouds","Heating lava","Raking sand","Balancing equations","Mixing fractions","Carrying the one","Picking apples","Lighting lanterns","Going on tangents","Pulling levers","Planting beanstalks","Turning on weather machines","Waking Floatlings","Sharpening pencils","Memorizing times tables","Brewing potions","Morphing marbles","Getting lost in archives","Preparing questions","Warming up dance moves","Lighting fireworks","Sweeping confetti","Packing snowballs","Baking cakes","Chasing waterfalls","Hiding secrets","Rehearsing lines","Counting vertices","Comparing sizes"],unusedText=[],cycleTextTimeout=null,LEGACY_ASSET_MAPPINGS="legacy-asset-mappings.json",LEGACY_PREFAB_MAPPINGS="legacy-prefab-mappings.json",LEGACY_DUPLICATE_ASSET_MAPPINGS="legacy-duplicate-asset-mappings.json";SW.Load.bgPath="https://cdn.prodigygame.com/game/assets/v1_cache/single-images/login-bg-13/1/login-bg-13.png",SW.Load.bgLoaded=!1,SW.Load.bgShowing=!1,SW.Load.RETRY_WAIT_MS=1e3,SW.Load.RETRY_ATTEMPTS_MAX=3,SW.Load.init=function(){var e=SW.Storage.get(SW.LoadIdentity.STORAGE_EVENT_DATA);if(e?window.eventData=JSON.parse(e):console.log("Warning: eventData not found."),SW.LoadIdentity.sentryInit(window.eventData),SW.LoadIdentity.displayVersion(),window.eventData.trackingCookie=SW.Load.getTrackingCookie(),!SW.LoadIdentity.isAutoLogin()){"true"===SW.Load.getUrlVar("launcher")?SW.Load.launcher().then((()=>console.log("Loading credentials"))).catch((()=>{console.log("Check for user failed. Signing redirect"),SW.Load.checkRedirect("checkForUser",SW.Errors.ERROR_CODE_OIDC_REDIRECT_SIGNIN)})):SW.Load.identityCheck(clockSkew)}var n=window.location.href.indexOf("?"),t="";if(n>=0){var o=window.location.href.indexOf("#");t=o>=0?window.location.href.substring(n,o):window.location.href.substring(n)}var i=prodigyUrlPrefix+(prodigyUrlPrefix.endsWith("/")?"":"/")+t;history.replaceState({},"Prodigy Game",i),SW.Load.sendLoadStart(),SW.Load.sendLoginEnd(),SW.Load.getSplashImage()},SW.Load.sendLoadStart=function(){SW.LoadIdentity.setupEventParams();const e=`${SW.LoadIdentity.getServiceURL()}events-api/v3/anonymous-events`,n={renderType:SW.Device.isWebGLSupported()?"webGL":"canvas"};window.loadStartTime=Date.now(),SW.LoadIdentity.sendV3Event(e,{type:"login_screen_funnel",name:"load_start",timeDelta:0},n)},SW.Load.sendLoginEnd=function(){const e=`${SW.LoadIdentity.getServiceURL()}events-api/v3/anonymous-events`,n=SW.Storage.get(SW.LoadIdentity.STORAGE_START_EVENT_TS),t={type:"login_time_funnel",name:"load_end",timeDelta:Date.now()-n};SW.LoadIdentity.sendV3Event(e,t)},SW.Load.getUrlVars=function(){var e=decodeURIComponent(window.location.href),n={};e.replace(/[?&]+([^=&]+)=([^&]*)/gi,(function(e,t,o){n[t]=o.replace(/\+/g," ")}));return n},SW.Load.getUrlVar=function(e){var n=SW.Load.getUrlVars();for(var t in n)if(t==e)return n[t]},SW.Load.getWebURL=function(){return prodigyWebUrl},SW.Load._request=function(e,n,t,o,i,a,r,s,d){void 0===i&&(i=SW.Load.RETRY_ATTEMPTS_MAX),a||(a="json"),r||(r="GET"),s||(s=!1);const c=new XMLHttpRequest;c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE)if(200===this.status){var d=s?c.response:c.response.data;n&&n(d)}else i>0?(i--,window.setTimeout((()=>{SW.Load._request(e,n,t,o,i,a,r,s)}),SW.Load.RETRY_WAIT_MS*(SW.Load.RETRY_ATTEMPTS_MAX-i))):(console.log("_request failed"),SW.LoadIdentity.setErrorScreen(`${t}: Too many requests. Gave up. Http status ${this.status}`,void 0,void 0,o))},c.responseType=a,c.open(r,e,!0),d&&(c.withCredentials=!0),c.send("")},SW.Load.getEducationStatus=function(){const e=`${SW.LoadIdentity.getEducationFrontendAssetsURL()}education-api/v1/frontend-paths`;SW.Load._request(e,(function(e){var n,t,o=e;"iOS"!==SW.Device.getOS()&&"Android"!==SW.Device.getOS()&&!SW.Device.isNativeApp()||SW.Device.isTablet()?(n=_.find(o,{id:"question-renderer"}).path,t=_.find(o,{id:"desktop-question-interface"}).path):(n=_.find(o,{id:"mobile-question-renderer"}).path,t=_.find(o,{id:"mobile-question-interface"}).path),window.questionRendererURL=n,window.questionInterfaceURL=t}),"Education Status",SW.Errors.ERROR_CODE_EDUCATION_STATUS,void 0,void 0,void 0,void 0,!0)},SW.Load.loadAssetsMappingJSON=function(){SW.Load._request(window.legacyAssetMappingsURL,(function(e){window.legacyAssetMappings=e}),LEGACY_ASSET_MAPPINGS,SW.Errors.ERROR_CODE_ASSET_MAPPINGS,void 0,void 0,void 0,!0)},SW.Load.loadDuplicateAssetsMappingJSON=function(){SW.Load._request(window.legacyDuplicateAssetMappingsURL,(function(e){window.legacyDuplicateAssetMappings=e}),LEGACY_DUPLICATE_ASSET_MAPPINGS,SW.Errors.ERROR_CODE_ASSET_MAPPINGS,void 0,void 0,void 0,!0)},SW.Load.loadPrefabMappingJSON=function(){SW.Load._request(window.legacyPrefabMappingsURL,(function(e){window.legacyPrefabMappings=e}),LEGACY_PREFAB_MAPPINGS,SW.Errors.ERROR_CODE_PREFAB_MAPPINGS,void 0,void 0,void 0,!0)},SW.Load.generateEventHandler=function(e,n){const t=o=>{let i={};const a=typeof o.data;if("object"===a)i=o.data;else if("string"===a)try{i=JSON.parse(o.data)}catch(r){console.error(`Could not parse JSON: ${o.data}`)}"object"==typeof i&&i.type===e&&(window.removeEventListener("message",t),n(i.success))};return t},SW.Load.isMinimumIapVersion=function(){const e=SW.Device.getMobileVersion();if(e.length<1)return!1;const n=e.indexOf(".");if(n<1)return!1;const t=e.substring(0,n),o=Number.parseInt(t);return!isNaN(o)&&o>=SW.IAP.MINIMUM_IAP_MOBILE_VERSION},SW.Load.loadGame=function(){window.onload=function(){SW.Load.checkPendingSplashScreen(),SW.LoadIdentity.checkPendingErrorScreen(),document.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1),prodigyWeb.membershipFlow={$el:$("#membership-flow"),$game:$("#game-wrapper"),student:{name:void 0,userID:void 0},closeCallback:void 0,isNativeIosApp:!1,open:function(e,n,t,o,i,a,r,s,d,c){let l="MLP";const S=SW.Load.isMinimumIapVersion();let u;this.isNativeIosApp=SW.Device.isNativeIosApp()&&S,u=this.isNativeIosApp?SW.Load.generateEventHandler("parental-gate-closed",(e=>{$("#parental-gate-container").hide(),e?this.performIAPFlow():this.close(!1)})):SW.Load.generateEventHandler("membership-iframe-closed",(e=>this.close(e))),window.addEventListener("message",u);const p=c?"upgrade":"game",g=SW.Load.getWebURL()+"Membership/"+p+"/?game=1&tag="+o+"&username="+e+"&id="+n+"&funnelName="+i+"&isPlayingFromHome="+a+"&metaData="+r+"&utm_source="+i+"&utm_medium=game&utm_campaign="+d+"&token="+s,I=$('<iframe src="'+g+'">');return this.student.name=e,this.student.userID=n,this.closeCallback=t,this.isNativeIosApp?(l="iOS-IAP",$("#iap-spinner").show(),$("#parental-gate-container").show()):this.$el.show().append(I),this.$game.hide(),l},performIAPFlow:function(){SW.IAP.purchaseItemAsync(SW.IAP.productId).catch((e=>{console.error(`purchase call failed: ${JSON.stringify(e)}`),this.close(!1)}))},close:function(e){this.isNativeIosApp?($("#iap-spinner").hide(),$("#eml-form-container").hide()):this.$el.hide().html(""),this.$game.show();const n=document.getElementsByTagName("canvas")[0];n.style.width=`${n.width}px`,n.style.height=`${n.height}px`,window.dispatchEvent(new Event("resize")),window.postMessage(JSON.stringify({name:"membership-flow-closed",success:e}),"*"),_.isUndefined(this.closeCallback)||this.closeCallback(e)}}},SW.Load.cycleLoadingText()},SW.Load.getDeviceInformationFromAPI=function(){const e=SW.Storage.get(SW.LoadIdentity.STORAGE_DEVICE_INFO);if(e)return void(window.deviceInformation=e);const n=new XMLHttpRequest;var t=SW.LoadIdentity.getServiceURL()+"device-detect-api/v1/information?";t=t+"user_agent="+navigator.userAgent,"undefined"!=typeof DeviceAtlas&&(t=t+"&properties="+encodeURIComponent(DeviceAtlas.getPropertiesAsString())),n.onreadystatechange=function(){if(n.readyState===XMLHttpRequest.DONE&&200===this.status){const e=n.response;e&&e.model&&(SW.Storage.set(SW.LoadIdentity.STORAGE_DEVICE_INFO,n.response),window.deviceInformation=e)}},n.responseType="json",n.open("GET",t,!0),n.send("")},SW.Load.setLoadingVisible=function(e){SW.LoadIdentity.setDivDisplay(SW.LoadIdentity.DIV_GAME_LOADING_CONTAINER,e)},SW.Load.cycleLoadingText=function(){var e=3500;if(0===unusedText.length)unusedText=[...loadingText],document.getElementById("loading-text").innerHTML="Loading game",e=1e3;else{var n=Math.floor(Math.random()*unusedText.length),t=unusedText[n];unusedText.splice(n,1),$(".game-loading__font").fadeOut(500,(()=>{$(".game-loading__font").fadeIn(500),document.getElementById("loading-text").innerHTML=t}))}window.clearTimeout(cycleTextTimeout),cycleTextTimeout=window.setTimeout(SW.Load.cycleLoadingText,e)},SW.Load.getSplashImage=function(){var e=new Image;return e.onload=function(){SW.Load.bgLoaded=!0,SW.Load.showSplashScreen()},e.src=SW.Load.bgPath,e},SW.Load.showSplashScreen=function(){var e=document.getElementById(SW.LoadIdentity.DIV_SPLASH_IMAGE);if(e){var n=e.style;SW.LoadIdentity.isErrorScreen()||(n.display=""),n.backgroundImage=`url(${SW.Load.bgPath})`,SW.Load.bgShowing=!0}else console.log("Warning: Splash screen div not found")},SW.Load.checkPendingSplashScreen=function(){return!(SW.Load.bgShowing||!SW.Load.bgLoaded)&&(SW.Load.showSplashScreen(),!0)},SW.Load.getTrackingCookie=function(){return SW.Cookie.getTrackingCookie()},SW.Load.checkRedirect=function(e,n){const t=`${e}`;-1!==t.indexOf("exp is in the past")||-1!==t.indexOf("iat is in the future")?SW.LoadIdentity.setErrorScreen(`Clockskew: ${e}`,SW.LoadIdentity.ERROR_TITLE_CLOCK_SKEW,SW.LoadIdentity.ERROR_DESCRIPTION_CLOCK_SKEW,n):SW.Cookie.getRedirectCookie()?(SW.LoadIdentity.setErrorScreen(`User signin redirect failed: ${e}`,void 0,void 0,n),SW.Cookie.clearRedirectCookie()):(SW.Cookie.setRedirectCookie(),SW.LoadIdentity.redirectToIdentity(authority,client_id,redirect_uri,promptParam))},SW.Load.launcher=async()=>{const e=SW.LoadIdentity.getServiceURL(),n=new Headers;n.append("Content-Type","application/json");const t=await fetch(`${e}game-cortex-server/v1/coreGame.getSession`,{method:"GET",credentials:"include",headers:n,redirect:"follow"}),o=(await t.json()).stored_data;o?SW.LoadIdentity.userInfo=()=>JSON.stringify({accessToken:o.identityToken,uuid:o.profile.sub,email:o.profile.email,name:o.profile.name,sid:o.profile.sid,identity_provider:o.profile.identity_provider,premises:o.profile.premises}):(console.log("Check for user failed. Signing redirect"),SW.Load.checkRedirect("checkForUser",SW.Errors.ERROR_CODE_OIDC_REDIRECT_SIGNIN))},SW.Load.identityCheck=function(e){SW.LoadIdentity.isErrorScreen()&&console.log("Do not IdentityCheck because error screen is displaying.");var n=new Oidc.UserManager({userStore:new Oidc.WebStorageStateStore(settings),clockSkew:e,loadUserInfo:!0});n.signinRedirectCallback().then((function(e){!async function(e){const n=await e.getUser();n?(SW.LoadIdentity.userInfo=()=>{const e=JSON.stringify({accessToken:n.access_token,uuid:n.profile.sub,email:n.profile.email,name:n.profile.name,sid:n.profile.sid,identity_provider:n.profile.identity_provider,premises:n.profile.premises});function t(){return e}return t()},window.addEventListener("beforeunload",(()=>{SW.LoadIdentity.logout()}))):(console.log("Check for user failed. Signin redirect"),SW.Load.checkRedirect("checkForUser",SW.Errors.ERROR_CODE_OIDC_REDIRECT_SIGNIN))}(n)})).catch((function(e){console.log(`signin redirect callback failure: ${e}`),SW.Load.checkRedirect(e,SW.Errors.ERROR_CODE_OIDC_REDIRECT_CALLBACK)}))},SW.Load.updateProgressBar=function(e){document.querySelector(SW.LoadIdentity.CSS_ED_PROGRESS_BAR).style.width=`${e}%`},SW.Load.loadFonts=function(){WebFont.load({custom:{families:["Fredoka One","Luckiest Guy","Paytone One","ABeeZee"]}})},SW.Load.loadSemaphore=1,SW.Load.decrementLoadSemaphore=function(){--SW.Load.loadSemaphore<=0&&SW.Load.onGameLoad()},SW.Load.onGameLoad=function(){if(window.gameApiStatusData.maintenance)SW.LoadIdentity.setErrorScreen(null,"Maintenance",window.gameApiStatusData.maintenanceMessage,SW.Errors.ERROR_CODE_LOADER_GAME_MAINTENANCE);else{window.updateGameLoaderProgress=SW.Load.updateProgressBar,window.gameLoaderLogout=SW.LoadIdentity.logout;var e=document.createElement("script");e.type="text/javascript",e.src="https://apis.google.com/js/platform.js?onload=onGooglePlatformLoad",e.async=!0,document.head.appendChild(e),Boot.init(),SW.Load.setLoadingVisible(!0),window.hideGameLoader=function(){window.prodigyLoadComplete?(window.prodigyLoaderHidden=!0,SW.Load.setLoadingVisible(!1)):window.prodigyLoadComplete=!0},_.delay((function(){window.hideGameLoader()}),1e3)}},SW.IAP={},SW.IAP.DEFAULT_PURCHASE_ITEM="prodigy_math_yearly_membership",SW.IAP.RECEIPT_VERIFICATION_MUTATION="mutation PurchaseInApp($receipt: String!) { purchaseInApp(input: { appleReceipt: $receipt }) { membershipId } }",SW.IAP.MINIMUM_IAP_MOBILE_VERSION=4,SW.IAP.isInit=!1,SW.IAP.userId=null,SW.IAP.authToken=null,SW.IAP.membershipId=null,SW.IAP.messageId=0,SW.IAP.callbacksById={},SW.IAP.productId=null,SW.IAP.purchaseCallback=e=>{console.error("Got an unhandled IAP purchase callback: ",e)},SW.IAP.performIAPCall=function(e,n){if(!SW.IAP.isInit)return;const t={payload:e};if(n){const e=SW.IAP.messageId;SW.IAP.messageId+=1,SW.IAP.callbacksById[e]=n,t.iapResponseId=e}setTimeout((()=>{window.postMessage(JSON.stringify({type:"CALL_IAP",payload:t}),"*")}),100)},SW.IAP.iapMessageListener=function(e){let n;try{n=JSON.parse(e)}catch(o){return void console.error(o)}const t=n.category;if("general"===t){const e=n.iapResponseId;if("number"==typeof e){const t=SW.IAP.callbacksById[e];delete SW.IAP.callbacksById[e],t(n.payload)}}else"purchaseListener"===t?SW.IAP.purchaseCallback(n.payload):console.error(`Unknown IAP message category: "${t}"`)},SW.IAP.verifyReceipt=function(e){return SW.IAP.sendGQLRequest(SW.IAP.RECEIPT_VERIFICATION_MUTATION,{receipt:e.transactionReceipt}).then((e=>{if(e&&e.purchaseInApp&&e.purchaseInApp.membershipId){const n=e.purchaseInApp.membershipId;SW.IAP.membershipId=n}})).catch((e=>{console.error(e)})).then((()=>SW.IAP.finishTransactionAsync(e,!1)))},SW.IAP.handleBadPurchaseResult=function(e){const n=e.responseCode;return window.prodigyWeb.membershipFlow.close(!1),1===n?Promise.resolve():2===n?(console.error("Purchasing error"),Promise.reject("purchasing error")):3===n?(console.error("Purchase was deferred"),Promise.reject("purchase deferred")):(console.error(`Unknown purchase error: ${n}`),Promise.reject(`Unknown purchase error: ${n}`))},SW.IAP.initIAP=function(e,n,t){if(SW.IAP.isInit)return Promise.resolve();if(!SW.Device.isNativeIosApp()||!SW.Load.isMinimumIapVersion())return Promise.resolve();SW.IAP.userId=e,SW.IAP.authToken=n,window.iapMessageListener=SW.IAP.iapMessageListener,SW.IAP.isInit=!0;const o=SW.Utility.getUrlVar("mobileProductOverride")||t||SW.IAP.DEFAULT_PURCHASE_ITEM;return SW.IAP.connectAsync().then((()=>SW.IAP.getProductsAsync([o]))).then((e=>{SW.IAP.productId=e[0].productId,SW.IAP.setPurchaseListener((e=>{if(e.responseCode>0)return SW.IAP.handleBadPurchaseResult(e);let n=!1;const t=[];for(let o=0;o<e.results.length;o+=1){const i=e.results[o];void 0===i.description&&(_.isString(i.transactionReceipt)?(n=!0,t.push(SW.IAP.verifyReceipt(i))):t.push(SW.IAP.finishTransactionAsync(i,!1)))}return Promise.allSettled(t).then((e=>{if(n&&e.length>0&&_.every(e,"value")){const e=SW.Load.generateEventHandler("membership-iframe-closed",(e=>window.prodigyWeb.membershipFlow.close(e)));window.addEventListener("message",e),$("#eml-form-container").show(),$("#game-wrapper").hide()}else window.prodigyWeb.membershipFlow.close(!0)})).catch((e=>{window.alert(`Receipt verification failed: ${e}`)}))}))}))},SW.IAP.connectAsync=function(){return new Promise(((e,n)=>{SW.IAP.performIAPCall({method:"connectAsync"},(t=>{t.result?e(!0):n(t.err)}))}))},SW.IAP.disconnectAsync=function(){return new Promise(((e,n)=>{SW.IAP.performIAPCall({method:"disconnectAsync"},(t=>{t.result?e(!0):n(t.err)}))}))},SW.IAP.getProductsAsync=function(e){return new Promise(((n,t)=>{SW.IAP.performIAPCall({method:"getProductsAsync",data:e},(e=>{e.result?n(e.itemDetails):t(e.err)}))}))},SW.IAP.purchaseItemAsync=function(e){return new Promise(((n,t)=>{SW.IAP.performIAPCall({method:"purchaseItemAsync",data:e},(e=>{e.result?n(!0):t(e.err)}))}))},SW.IAP.finishTransactionAsync=function(e,n){return new Promise(((t,o)=>{SW.IAP.performIAPCall({method:"finishTransactionAsync",data:{purchase:e,consumeItem:n}},(e=>{e.result?t(!0):(console.error(`Transaction finished with error: ${JSON.stringify(e)}`),o(e.err))}))}))},SW.IAP.getPurchaseHistoryAsync=function(e){return new Promise(((n,t)=>{SW.IAP.performIAPCall({method:"getPurchaseHistoryAsync",data:e},(e=>{e.result?n(e.purchaseDetails):t(e.err)}))}))},SW.IAP.setPurchaseListener=function(e){SW.IAP.purchaseCallback=e,SW.IAP.performIAPCall({method:"setPurchaseListener"})},SW.IAP.sendGQLRequest=function(e,n){if(!SW.IAP.isInit)return Promise.reject("IAP is not initialized before GQL request.");if(null===SW.IAP.userId)return Promise.reject("No user ID for GQL request.");if(null===SW.IAP.authToken)return Promise.reject("No auth token for GQL request.");const t=`${SW.LoadIdentity.getAPIRootUrl()}/graphql/`;return new Promise(((o,i)=>{const a=new XMLHttpRequest;a.open("POST",t,!0),a.setRequestHeader("token",SW.IAP.authToken),a.setRequestHeader("userID",`${SW.IAP.userId}`),a.setRequestHeader("usertype","student"),a.setRequestHeader("apollographql-client-name","prodigy-game"),a.setRequestHeader("apollographql-client-version","1.0"),a.setRequestHeader("Content-Type","application/json"),a.onreadystatechange=()=>{if(a.readyState===XMLHttpRequest.DONE){const n=a.status;if(0===n||n>=200&&n<400)try{const e=JSON.parse(a.responseText);o(e.data)}catch(e){i(`JSON Parse Error for: ${a.responseText}`)}else i(`${n} ${a.statusText}`)}},a.send(JSON.stringify({query:e,variables:n||{}}))}))},SW.Load.setOldDeviceErrorScreen=function(){SW.LoadIdentity.setDivDisplay("warning-div",!0),SW.LoadIdentity.setDivDisplay(SW.LoadIdentity.DIV_LOADING,!0),SW.LoadIdentity.setDivDisplay(SW.LoadIdentity.DIV_SPLASH_IMAGE,!1),document.getElementById("loading-div").style.display="none";const e=SW.Load.ERROR_TITLE_OLD_DEVICE;document.getElementById("warning-title").innerHTML=e;const n=SW.Load.ERROR_DESCRIPTION_OLD_DEVICE;document.getElementById("warning-text").innerHTML=n,document.getElementById("openfaq").onclick=()=>(SW.Load.showLeaveGamePrompt(SW.Load.WEBGL_FAQ_URL),!1)},SW.Load.showLeaveGamePrompt=function(e){const n=e=>SW.LoadIdentity.setDivDisplay("leave-game-panel",e);n(!0),document.getElementById("leave-button").onclick=()=>{SW.Device.openWebsite(e),n(!1)},document.getElementById("stay-button").onclick=()=>n(!1)};